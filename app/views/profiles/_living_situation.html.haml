#living-situation.pt4.pb1
  .max-width-3.mx-auto.mt4
    .clearfix.mb2
      .col.col-12.center
        .max-width-1.mx-auto.h2.line-height-2
          Let's learn about your home
    / -flash.each do |key, value|
    /   .flash.center
    /     =value
    .clearfix.mx-auto
      =simple_form_for @profile, remote: true do |form|
        .sm-col.sm-col-12.px2
          .clearfix
            .sm-col.sm-col-6.px2
              %label.h4 ADDRESS LINE 1
              %br
              =form.input_field :address_line_1, class: "h3 bg-transparent rounded border border-width-2 height-40 required-field"
              %label.h4 ADDRESS LINE 2 (Optional)
              %br
              =form.input_field :address_line_2, class: "h3 bg-transparent rounded border border-width-2 height-40"
              .clearfix
                .sm-col.sm-col-12.md-col-6.md-pr2
                  %label.h4 CITY
                  %br
                  =form.input_field :city, class: "h3 bg-transparent rounded border border-width-2 height-40 required-field"
                .sm-col.sm-col-6.md-col-3.sm-pr2
                  %label.h4 STATE
                  %br
                  =form.input_field :state, collection: us_states, class: "h3 bg-transparent rounded border border-width-2 required-field"
                .sm-col.sm-col-6.md-col-3
                  %label.h4 ZIP
                  %br
                  =form.input_field :zip_code, class: "h3 bg-transparent rounded border border-width-2 height-40 required-field", maxlength: "5"
              %label.h4 PHONE
              %br
              =form.input_field :phone, class: "h3 bg-transparent rounded border border-width-2 height-40 required-field"

            .sm-col.sm-col-6.sm-pl4
              .mb2.px2
                %label.h4 HOUSING
                %br
                %button.btn-housing{type: "button", style: "font-weight:bold; border: 2px solid black; width:75px; height: 30px; border-top-left-radius: 15px; border-bottom-left-radius: 15px;", data: {value: "rent"}, class: "bg-white #{@profile.housing == 'rent' ? 'btn-housing-active' : 'bg-white'}"} RENT
                %button.btn-housing{type: "button", style: "margin-left:-6px;font-weight:bold; border: 2px solid black; width:75px; height: 30px; border-top-right-radius: 15px; border-bottom-right-radius: 15px;", data: {value: "own"}, class: "bg-white #{@profile.housing == 'own' ? 'btn-housing-active' : 'bg-white'}"} OWN
              .mt2.px2.sm-pl4.sm-mt3
                %label.h4 AVG ELECTRIC BILL (Optional)
              .inline-block.pl2
                #slider{style: "width:200px;"}
              .inline-block
                %h2.m0
                  &nbsp;$
                  %span#slider_val 0
              =form.input :housing, :as => :hidden, :input_html => { :value => @profile.housing , class: 'required-field'}
              =form.input :avg_electrical_bill, :as => :hidden, :input_html => { :value => @profile.avg_electrical_bill || "0" }
          .mt3.px2
            =form.submit "BACK", class: "bg-white black inline-block", style: "border: 2px solid black; border-radius: 20px;width: 120px; height: 40px;"
            =form.submit "NEXT", disabled: true, class: "bg-gray white right border-none inline-block", style: "border-radius: 20px;width: 120px; height: 40px;"


:javascript
  $( document ).ready( function() {

    $('#navbar, #navbar-brand, #link-login').css('color', '#666666');

    $( "#slider" ).slider({
      animate: "fast",
      max: 250,
      value: #{@profile.avg_electrical_bill},
      create: function( event, ui ) {
        $('#slider_val').html(#{@profile.avg_electrical_bill});
      },
      slide: function( event, ui ) {
        $('#slider_val').html(ui.value);
        $('#profile_avg_electrical_bill').val(ui.value);
      }
    });

    $requiredFields = $('.required-field');
    var requiredFieldsComplete = false;

    var validateRequiredFields = function($fields){
      $.each($fields,function(index, value){
        if($(value).val() == ""){
          requiredFieldsComplete = false;
          $("input[value='NEXT']").attr("disabled", true);
          $("input[value='NEXT']").removeClass("btn-submit-active");
          return false;
        }
        if($('#profile_housing').val() != ""){
          requiredFieldsComplete = true;
          $("input[value='NEXT']").prop("disabled", false);
          $("input[value='NEXT']").addClass("btn-submit-active");
        }
      });
    }

    //initial state
    validateRequiredFields($requiredFields);

    //state machine
    $requiredFields.bind('input change', function(){
      validateRequiredFields($requiredFields);
    });

    $('.btn-housing').on('click', function(){
      $('.btn-housing').not(this).removeClass('btn-housing-active');
      $(this).toggleClass('btn-housing-active');
      if( $('.btn-housing-active').size() > 0 ){
        var val = $(this).data("value");
        $('#profile_housing').val(val);
        validateRequiredFields($requiredFields);
      }else{
        $('#profile_housing').val("");
        validateRequiredFields($requiredFields);
      }
    });
  });
