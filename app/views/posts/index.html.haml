.max-width-4.mx-auto.relative
  .clearfix
    .col.col-12.sm-col.sm-col-8
      - if @posts != nil
        - @posts.each_with_index do |post, index|
          #post.clearfix.my4
            .col.col-12.md-col.md-col-6
              - thumbnail = extract_post_thumbnail_src(post)
              = link_to image_tag(thumbnail), post_path(post['id'], cat: post['categories'])
            .col.col-12.md-col.md-col-6.px2
              - if article_for_member_only?(post['categories'])
                .blue premium content
              %h2.mt0
                = link_to (raw post['title']['rendered']), post_path(post['id'], cat: post['categories']), class: 'text-decoration-none gray-60'
              %h3.gray-60
                = post['excerpt']['rendered'].html_safe
              %p.gray-60 By #{post['author_meta']['display_name']}, #{format_post_date(post['date'])}
    .col.col-12.md-col.md-col-4.mt4#sb-anchor-rail
      #subscribe-box-wrapper
        = render "subscribe_box", :inherit_width => false
.center#sb-lower-bounds
  - if !@paginatable_array.nil?
    = paginate @paginatable_array

:javascript
  $(document).ready(function(){

    /*
    (function(){
      var rail = $('#sb-anchor-rail');

      return function(){alert('tst');}
    })();
    */

    $(window).on("resize scroll", function(){
      //distance scrolled from top
      var scrollTop     = $(window).scrollTop();
      
      //box fixation point distance from top
      var elementOffset = $('#sb-anchor-rail').offset().top;
      //var boundOffset = $('#sb-lower-bounds').offset().top;
      
      //console.log(boundOffset);
      
      //when scroll reaches box fixation point, 
      //update css to fix the box to top of window
      var distance = (elementOffset - scrollTop);

      //when width < md breakpoint (832) px, fixed box is set to relative position
      var xWidth = $(window).width();

      //ensure box width remains the same as the anchor rail
      var railWidth = $('#sb-anchor-rail').width();
      if (xWidth > 832) {
        // console.log(distance);
        if(distance < 0) {
          $('#subscribe-box-wrapper').css({'position': 'fixed', 'top': 0, 'width': railWidth.toString() + 'px'});
        }
        if(distance >= 0){
          $('#subscribe-box-wrapper').css({'position': 'relative', 'width': railWidth.toString() + 'px'});
        }
      } else {
        $('#subscribe-box-wrapper').css({'position': 'relative', 'width': '100%'})
      }
    });
  });